node {
   
    stage('pre-build') { 
        sh '''
            sudo rm -rf docker-java
        '''
        git 'https://github.com/kiladia123/docker-java.git'
       
    }
    stage('Build') {
        
                sh '''
                pwd
                cd docker-spring-boot
                mvn clean package
                sudo docker build -t alpha007 .
                '''
            
        
    }
   stage('push') {
        
        sh'''
               sudo aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 714549394535.dkr.ecr.us-east-1.amazonaws.com 
                sudo docker tag alpha007:latest 714549394535.dkr.ecr.us-east-1.amazonaws.com/alpha007:latest
                sudo docker push 714549394535.dkr.ecr.us-east-1.amazonaws.com/alpha007:latest
                
                echo 'container push to ecr'
        '''
    }
    stage('run') {
        
        sh'''
                sudo docker stop springboot && sudo docker rm springboot 
                sudo docker run --name springboot -d -p 8090:8080 -t springboot:latest
                echo 'containers running'
        '''
    }
}
